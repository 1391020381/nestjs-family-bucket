# 垃圾回收
1. 垃圾数据的自动回收
    - javascript中的数据存储方式 
        - 原始数据类型存储在栈空间
        - 引用类型数据存储在堆空间
    - 垃圾回收策略
        - 手动回收
        - 自动回收 
2. js中垃圾数据回收
    - 调用栈中的数据回收
        - 执行流程分析
        - ESP指针的作用
    - 堆中的数据回收
        - 代际假说和分代收集
            - 第一个是大部分对象在内存中存在的时间很短,简单来说,就是很多对象一经分配内存,很快就变得不可访问。
            - 第二个不死的对象 会活的更久。
            - V8中会把堆分为 新生代 和老生代 两个区域 新生代中存放的是生存时间短的对象 老生代中存放的生存时间久的对象。
        - 垃圾回收器的工作流程
            - 副垃圾回收器  Scavenge算法 对象晋升策略    
            - 主垃圾回收器  标记清楚算法 标记整理
            - 全停顿  增量标记算法

            - 垃圾回收的工作流程 
                1. 标记空间中活动对象（还在使用的） 非活动对象(垃圾回收的对象)  
                2. 回收非活动对象所占据的内存。 
                3. 内存整理   频繁回收对象后,内存中就会存在大量不连续的空间 即 内存碎片。
            - 副垃圾回收器 新生代 Scavenge算法（对象区域/空闲区域  标记对象区域 垃圾清理  复制存活对象到空闲区域并有序排列 完成复制 角色翻转 ）  对象晋升策略 （经历过两次垃圾回收机制还存活的对象 会被移动到老生区中）
            - 主垃圾回收器 老生代   标记清除   标记整理

            - 全停顿   由于js运行在主线程上，一旦执行垃圾回收算法,都需要将正在执行的js脚本暂停下来,待垃圾回收完毕后再恢复脚本执行。 老生代 V8将标记过程分为一个个子标记过程,同时让垃圾回收标记和js逻辑交替进行,直到标记阶段完成。  增量标记 算法。
    - 垃圾回收策略的权衡
    - 工程师的视角

    - 判断js中内存泄漏的方法
    - 工作中避免内存泄漏的方法                   




* 在使用JavaScript的过程中，判断内存泄漏通常需要监控和管理内存使用情况。以下是一些判断和避免内存泄漏的方法：

监控内存使用：可以使用浏览器的开发者工具（如Chrome的DevTools）来监控内存使用情况。这些工具通常提供内存泄漏的检测和分析功能。

引用计数：JavaScript的垃圾回收器使用引用计数来决定何时释放对象。如果一个对象的引用计数为零，意味着它不再被使用，垃圾回收器将会回收它。你可以通过减少对对象的引用来帮助垃圾回收器回收内存。

标记-清除：这是JavaScript垃圾回收器的另一种工作方式。通过标记不再使用的对象，然后在下一个垃圾回收周期中清除这些对象占用的内存。确保未引用的对象被标记为可回收，可以帮助避免内存泄漏。

避免循环引用：在创建对象时，尤其是当对象之间存在循环引用时，要注意解绑这些引用，以便垃圾回收器可以回收这些对象。

**使用WeakMap和WeakSet**：这些数据结构可以帮助你存储对象，而不增加它们的引用计数，这样垃圾回收器就可以回收这些对象。

定期清理：对于一些可能不再需要的对象或资源（如DOM元素、定时器、事件监听器等），定期进行清理可以防止内存泄漏。

使用事件池：在处理大量事件时，使用事件池可以避免为每个事件创建新的对象，从而减少内存使用。

避免匿名函数和闭包：匿名函数和闭包可能会导致意外的引用，从而阻止垃圾回收器回收内存。如果必须使用，确保在不再需要时解绑或设置为null。

代码审计：定期对代码进行审计，检查是否有未释放的内存引用，特别是那些长期存在的对象。

工具和库：使用像LeakDetector、memwatch-next等第三方工具和库来帮助检测和分析内存泄漏。


代码示例：
// 避免内存泄漏的示例
function createElement(data) {
  const element = document.createElement('div');
  element.textContent = data;
  // 假设某个时刻我们不再需要这个元素
  // 解绑事件监听器，并设置为null，以便垃圾回收器可以回收
  element.addEventListener('click', onClick);
  function onClick() {
    // 处理点击事件
  }
  // 当元素不再需要时，移除事件监听器并设置为null
  // 这样可以帮助垃圾回收器回收内存
  element.removeEventListener('click', onClick);
  element = null;
}

总结：判断和避免JavaScript内存泄漏需要监控内存使用、理解垃圾回收机制、避免循环引用、定期清理不再使用的对象和资源，以及使用适当的工具和技术来帮助分析和检测内存泄漏。
