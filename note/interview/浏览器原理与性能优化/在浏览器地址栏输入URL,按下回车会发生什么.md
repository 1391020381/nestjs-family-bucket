* 从浏览器渲染立即 Web 性能

* 了解浏览器渲染的基本流程
* 了解影响网页渲染的因素
* 从而了解网页性能优化的方式

1. 域名解析
    - 协议
    - 域名
    - 路径
    - 隐藏属性 端口
    - 隐藏属性 检索参数  如 ?a=foob=2
    - 隐藏属性 锚点  #comments

* 影响性能的关键 域名解析
    - 将域名解析成ip
    - 由近及远查询
    - 默认使用缓存
* 优化方向
    - 使用 dns-prefetch
    - 减少域名数量
    - 使用第三方知名域名

2. 建立连接
    - 浏览器会尝试连接对方的服务器
    - 因为彼此存在不同的网络环境 连接过程会比较复杂
    - 这个阶段优化空间不大 一般和服务器部署有关
    - 后端可以使用 CDN缓存。

3. 发起请求
    - 浏览器构建请求
    - 请求方法 http method
    - 请求路径 path
    - 请求头 headers
    - 请求体 body
* 优化方向
    - 减少请求数量
    - 利用 cookie   传递初始化所需的数据 

4. 下载网页
    - 检查响应头 是否使用缓存
    - 是  直接启用缓存 进入渲染阶段
    - 否 下载网页


    - 尽量不要给html加缓存 以避免更新问题。


5. 边解析边渲染
    - 边下载 边解析 边渲染
    - link 不会阻塞渲染
    - script 可能会阻塞渲染
    - 图片 视频等资源一般不会阻塞渲染
    - 因为嵌套关系 渲染一般发生在闭合标签时
    - 加载完成 分别触发 load domcontentloaded事件
* 优化方向
    - 尽量将 script 放在 body末尾
    - 添加 defer async属性
    - 业务无关的代码 比如统计脚步 建议最后加载
* 影响性能优化的因素 首屏渲染
    - FCP First Contentful Paint 第一次渲染的时间点 发生在 head 加载完成后
    - FCP 一般不会影响渲染的总时间 但对用户体验帮助巨大
    - 通常来说 我们希望 FCP < 1s
* 优化方向
    - 将关键样式放在 heade 中
    - head 里不要放阻塞脚本
    - 首屏 html要放在一个闭合标签里
    - 使用骨架屏    

* 影响性能优化的因素 并行下载
    - http/1.1 可以同时从一个域名下载6个资源
    - http/2 通过复用连接 可以同时下载更多资源
* 优化方向
    - 服务器使用 http/2 协议
    - 如果使用http/1.1 可以使用多个域名  否则 少使用一些域名   js css img 分开域名
    - 压缩请求
    - 减少首次加载内容 使用 lazy-laod加载图片等资源
    - 非核心内容人工延迟加载    

* 影响性能优化的因素 CLS
    - CLS （Cumulative Layout Shift）是页面布局的稳定性
    - 如果在渲染过程中 页面出现大量布局变化 会影响用户体验
* 优化方向
    - 使用骨架屏
    - 减少使用 web fonts
    - 给图片添加起始尺寸
    - 避免后期加载的内容导致页面变化    

* 影响性能优化的因素 LCP
    - LCP (Largest Conntentful Panit ) 是网页   最大内容的渲染时间
    - 面积最大的内容 通常也是最重要的内容 
* 优化方向 
    - 将关键内容放在网页文件的前面
    - 通过样式调整 满足产品的需求的同时 让关键内容尽早渲染     

6. 加载资源
    - 同样的效果 体积可能大不一样
    - 优化资源 不仅提升体验 还给 自己省钱。
* 优化方向 
    - 减少请求的数量
    - 压缩图片 位图 webp 矢量 svg
    - 压缩视频 mp4
    - 使用视频替代 gif
    - 增加缓存时间
7. 执行js    
* spa 的关键步骤
* spa js负责渲染页面
*  js执行时间 直接影响到用户体验

* 影响性能优化的因素  执行效率
    - 原生 api 性能更好
    - 新特性 通常由更好的优化效率
    - 静态代码更容易优化
* 优化方向
    - 在开发中多使用新特性 通过构建工具保证兼容性
    - 通过统计工具 照顾尽可能多的用户 但还要适当提高目标平台的要求
    - 配置编译工具 尽可能使用原生 api
    - 不要使用 eval new Function等方法    
* 影响性能优化的因素 代码量
    - 代码量越少 下载时间越短
    - 代码量越少 执行时间越短
    - 用户通常只需要20%的功能 不要让他们下载100%的代码

* 优化方向
    - 代码分模块 按需加载
    - 使用 ES Module 配合 http/2
    - 使用 tree-shaking
    - 使用高版本的第三方库    

    - 代码分模块时 根据使用场景分组
    - 升级依赖的时候 尽量集中更新某个模块
    - 尽量让生成的代码具备一样的hash
    - 如果有多个项目 则尽量使用同样的分包
8. 渲染完成
    * 现代前端spa 的渲染通常分阶段
        - 得到服务器响应后，快速渲染出骨架屏
        - 加载必要的资源后,渲染出首屏
        - 渲染出大部分页面骨架 等待静态资源慢慢加载

* 影响性能优化的因素 ssr

9. 为用户回访 站内跳转
    - 静态资源保留较长时间
    - 加强资源复用 减少请求
    - 提前预缓存 预加载 本地化所需资源
    - 不常变的数据 缓存在用户本地