# 领域事件

- 领域事件表示的是，业务流程中每个步骤引发的结果。

# 命令

- 所谓命令(command) 就是引发领域事件的操作,我们可以通过分析领域事件得到。
- 除了识别出命令本身以外,我们通常还要识别出谁执行了命令,以及为了执行命令我们要查询出什么数据。

# 识别领域名词

- 领域名词 是从命令 领域事件 执行者 查询数据里找到的名词性概念。

# 领域建模实践

- 建立领域模型 主要是识别 领域对象 (domain object) 领域对象之间的关系 以及 领域对象的关键属性
- 必要的时候还要 将 领域对象组织成模块
- 系统中要处理的各种 事物 就是领域对象。
- 领域建模阶段 主要关注的是 实体和它们之间的关系。

- 领域事件
  - 领域动作
  - 行业规则
  - 命令
  - 需要查询名词
- 领域模型

  - 领域对象 我们系统中要处理的各种 事物 就是领域对象
  - 领域对象之间的关系
  - 领域对象的关键属性
  - 将领域对象组织成模块

- UML(统一建模语言)
  - 领域对象的名称
  - 对象的属性

* 实体(entity)
* 值对象( value object)
* 由类和他们之间的关系组成的图叫做类图, 也是领域建模李用到的最主要的图。
* 归纳共性 特性可用其他类别标识
* 在UML中 注释用折角的矩形表示 和被注释的实体之间用虚线连接
* 1表示对一关系, \* 表示对多关系
* 组织实体上有一个自己到自己的一对多的关联。 意思 一个组织可以有多个组织作为自己的下级 而一个组织只能有一个组织作为自己的上级
* 在 UML中，用大括号括起来的内容称为 "约束" 和一般性的注释不同, 凡是约束 必须在程序中某个地方进行实现
* 约束也是一种业务规则,应该加进前面讲过的业务规则表。

* 租户
  - 只有企业才能作为租户
  - 系统中所有实体都应属于某个租户,以便隔离不同租户的数据 为了简洁,不一一画出关联了。
* 组织
  - 开发组的上级只能是开发中心
  - 开发中心和直属部门的上级只能是企业
  - 企业没有上级
  - 开发组和直属部门没有下级
* 组织类别

  - 企业
  - 开发组
  - 直属部门

* 员工

* 岗位
  - 管理员
  - 人事人员

# UML 包

- UML中表示依赖关系,箭头由依赖方指向被依赖方

- 关联表示的是数据上的导航关系。
- 依赖表示的意思更为广泛。 如果A B两个元素,有了A才能有B,那么就可以说 B依赖于A

- 领域模型(领域事件)
- 完善业务规则
- 建立词汇表

* 现实世界 -> 捕获行为需求(用例 事件风暴) -> 分析(对业务概念进行抽象) -> 设计(架构设计/详细设计/数据库设计) -> 编写代码

# 物理数据模型

- 主要目的就是对数据表进行设计

  - 建立哪些表
  - 表中有哪些字段
  - 表的主键和外键是什么
  - 字段的数据类型以及约束

- created_at created_by last_updated_at last_updated_by
- 通常称为审计字段 可以用来进行安全审计和错误排查。 作为一种最佳实践,我们再每一个表中都会包含着四个字段

- 在基于云的应用里,为了减少数据库处理的瓶颈,一般不主张建立真正的外键,而是用程序来保证外键约束。
- 但是在物理数据模型里,又希望表达外键参照,方便理解数据表间的关系。 这时候 我们可以把实线箭头换成虚线箭头，表示 虚拟外键。

- 云架构避免它原因

  - 性能瓶颈 外键约束意味着每次插入 更新或删除操作,数据库都需要去检查另外一张表(可能在不同的磁盘位置) 这会带来额外的锁竞争和性能开销。 在高并发场景下,很容易成为系统瓶颈
  - 不利于水平扩展
  - 死锁风险
  - 耦合性高

- 私有化部署Sass
  - 可以使用 数据库真实外键
  - 程序逻辑保证兜底
  - 即使数据库底层没有设置物理外键约束，只要在数据模型设计和程序逻辑上明确了表之间的关联关系，ORM 框架完全能够基于这些“逻辑上的外键”来实现高效、便捷的关联查询。
